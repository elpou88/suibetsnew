<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>SuiBets - Crypto Sports Betting Platform</title>
    <link rel="icon" type="image/png" href="/logo/suibets-logo.png" />
    
    <!-- ULTRA-EARLY: Block MetaMask/Ethereum errors BEFORE anything else loads -->
    <script>
      // This runs FIRST before any extensions can inject
      (function() {
        // Block ethereum injection from showing errors
        Object.defineProperty(window, 'ethereum', {
          get: function() { return undefined; },
          set: function() { return true; },
          configurable: true
        });
        
        // Early error handler
        window.onerror = function(msg) {
          if (msg && (
            msg.includes('MetaMask') || 
            msg.includes('ethereum') || 
            msg.includes('inpage') ||
            msg.includes('chrome-extension')
          )) {
            return true; // Suppress
          }
        };
      })();
    </script>
    
    <script src="/debug-script.js"></script>
    <!-- CRITICAL: Disable Vite HMR completely to prevent WebSocket errors in Replit -->
    <script>
      // Disable HMR for Replit environment BEFORE any other scripts load
      window.__VITE_DISABLE_HMR__ = true;
      
      // Trap and suppress ALL WebSocket construction errors
      const OriginalWebSocket = window.WebSocket;
      window.WebSocket = function(...args) {
        try {
          return new OriginalWebSocket(...args);
        } catch (e) {
          if (e.message?.includes('wss://localhost:undefined') || e.message?.includes('Failed to construct')) {
            console.log('[HMR-SUPPRESSED] WebSocket connection blocked');
            // Return a mock WebSocket that immediately closes to prevent errors
            return {
              readyState: WebSocket.CLOSED,
              send: () => {},
              close: () => {},
              addEventListener: () => {},
              removeEventListener: () => {}
            };
          }
          throw e;
        }
      };
      
      // Suppress all unhandled promise rejections related to HMR/WebSocket
      window.addEventListener('unhandledrejection', event => {
        const msg = event.reason?.message || String(event.reason || '');
        if (msg.includes('WebSocket') || 
            msg.includes('HMR') ||
            msg.includes('Failed to construct') ||
            msg.includes('localhost:undefined') ||
            msg.includes('HMR disabled')) {
          console.log('[HMR-SUPPRESSED] Unhandled rejection prevented');
          event.preventDefault();
        }
      }, true);
      
      // Aggressively suppress console errors related to browser extensions
      const suppressPatterns = ['WebSocket', 'HMR', 'MetaMask', 'ethereum', 
        'chrome-extension', 'moz-extension', 'inpage.js', 'contentscript',
        'eth_', 'web3', 'Ethereum', 'provider.request'];
      
      const shouldSuppress = (str) => {
        if (!str) return false;
        const lower = str.toLowerCase();
        return suppressPatterns.some(p => lower.includes(p.toLowerCase()));
      };
      
      const originalError = console.error;
      console.error = function(...args) {
        const msg = args.map(a => String(a || '')).join(' ');
        if (!shouldSuppress(msg)) {
          originalError.apply(console, args);
        }
      };
      
      // Block ALL browser extension error events immediately
      window.addEventListener('error', function(event) {
        if (shouldSuppress(event.message) || 
            shouldSuppress(event.error?.message) ||
            shouldSuppress(event.error?.stack) ||
            shouldSuppress(event.filename)) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          return false;
        }
      }, true);
      
      // Also block any error overlay elements that extensions might inject
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1) {
              const el = node;
              if (el.id?.includes('metamask') || 
                  el.className?.includes?.('metamask') ||
                  el.id?.includes('error-overlay') ||
                  el.innerHTML?.includes?.('MetaMask')) {
                el.remove();
              }
            }
          });
        });
      });
      observer.observe(document.documentElement, { childList: true, subtree: true });
      
      // Clear stale wallet data on every page load
      try {
        localStorage.removeItem('wallet_address');
        localStorage.removeItem('wallet_type');
      } catch(e) {}
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- This script injects a replit badge into the page, please feel free to remove this line -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-badge-v3.js"></script>
  </body>
</html>